# test2 in test2 branch
======================================
Общее описание задачи: посетители на сайте бронируют посещение. Если кол-во броней на одну дату больше или равно 5 (параметр N, описанный ниже), то они не могут выбрать в календаре дату.
Чтобы понять, есть ли уже 5 посещений на нужную дату или нет, мы делаем обращение к API платформы Yadro и выбираем из amoCRM сделки на определенных статусах (несколько), и проверяем какая дата у них заполнена.


Входной параметр - ИД доп. поля с датой; ИД статуса сделки (несколько).
В первую очередь нужно написать функцию, которая будет отдавать количество сделок на определенных статусах с определенным значение	м поля типа даты (поле типа даты - это любое одно доп. поле в Сделке с типом Дата. Если его нет, то для себя для тестов нужно создать вручную в amoCRM). Условно, "покажи, сколько сделок на статусе таком и таком с значением поля равным 25.06.16".

Затем нужно адаптировать, чтобы значения отдавались в массиве на 30 дней вперед начиная со значения поля равному сегодняшнему. Если для оптимизации кол-ва запросов нужно переписать функцию, а не пользоваться ей в цикле, то лучше так и сделать.

Далее пишем JS-обработчик, на отдельной HTML-странице, используя JQuery,
который вызывает эту функцию и складывает в массив. В JS-коде задать переменную N = 5. Сделать еще один массив, с теми же ключами, но в котором значение будет 1, если значение первого массива меньше N, и 0, если больше или равно N.
	
На фронте создать текстовое поле с календарем http://glad.github.io/glDatePicker/#examples. В календаре, должны быть доступны только будущие даты в том случае, если в новом массиве напротив нужной даты стоит значение 1.

Итогом является PHP-скрипт бекэнда и HTML-страница с правильно отображающимся календарем. В тестах необходимо довести нужное количество сделок с одной датой, чтобы в календаре хотя бы пару дней были неактивны.

Вопросы:
1. на одну дату может быть несколько броней от разных посетителей? но не больше 5?
2. статусы будут известны?
3. Ид доп поля с датой будет известно?
4. Хотел уточнить общую концепцию: мы создаем html-страницу с полем дата, которая при помощи jquery обрабатывает запрос и запрашивает информацию от php-скрипта, который тянет информацию по api?

Ответы:
Да, на одну дату может быть несколько броней от одного/разных посетителей. Но не больше N
Статусы для тестов можно использовать любые. 
Доп. поле даты можно выбрать любое
Да, все верно


Если возникнет вопрос, за какой период проверять сделки, то можно отфильтровать сделки по дате изменения (сегодня плюс 30д), т.е. запись более чем за 30 дней невозможна, поэтому нет смысла проверять настолько старые сделки

===================================================


# test1 in master branch
===================================================
Нужно написать функцию, которая будет принимать "дату от", "дату до" . Дата задается в формате timestamp. Она получает список всех сделок в аккаунте на статусе "Успешно реализовано", и циклом фильтрует сделки по дате закрытия. В подходящих суммирует бюджет. Результат функции — суммарный бюджет по та	ким сделкам.


Далее нужно пройтись по всем клиентам в Ядре и если их доступы в amoCRM актуальны, то просуммировать все суммарные бюджеты. Таким образом мы получим общую сумму закрытых сделок по всем нашим клиентам от какого-то времени до какого-то.

Итогом является PHP-скрипт с GET-параметрами date_from и date_to, который отдает html-таблицу с тремя колонками: ID клиента в Ядре, название клиента, сумма его успешных сделок за период. А также отдельно конечную цифру — сумму по вс	ем клиентам за период.

Получение списка клиентов нужно реализовать внутренней функцией, которая возвращает массив клиентов. Пока в качестве такого списка будет один клиент:
function getClients() {
    return [
        [
            ‘id’ => 1,
            ‘name’ => ‘intrdev’,
            ‘api’ => ‘’
        ],
        [
            ‘id’ => 2,
            ‘name’ => ‘artedegrass0’,
            ‘api’ => ‘’,
        ],
    ];
}

Работу с amoCRM необходимо реализовать, используя внутреннее API платформы Yadro.

Проверить актуален доступ в amoCRM или нет можно с помощью метода /crm/account. Если данные возвращаются, то значит доступ есть.
